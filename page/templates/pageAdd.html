{% extends "pageBase.html" %}
{% block title %}Añadir al pedido{% endblock %}
{% block urls %}
{% load static %}
{% endblock %}
{% block body %}

<section class="desktop añadir mt-4">
    <div class="row px-3">
        <div class="col-lg-3 col-xl-2 col-md-3">
            <div class="container-search desk">
                <input placeholder="Realizar búsqueda..." type="text" name="search" class="search"
                    id="search-input-desk">
                <i class="fas fa-times search-clear-icon" id="search-clear-desk"></i>
            </div>
            <p id="title-search"><strong>MEJORES VENTAS</strong></p>
            <ul class="list-group d-flex gap-4" id="toggle-main-search-desk"></ul>
        </div>
        <form class="col-xl-10 col-lg-9 col-md-9 px-4 form product-form-desk" data-id="{{ producto.id_producto }}">
            <div class="col-md-11 mt-3 mx-auto pb-1 d-flex justify-content-between align-items-center flex-wrap">
                <div class="col-xl-4 col-md-12">
                    <swiper-container class="mySwiper my-auto" keyboard="true" space-between="30" pagination="true"
                        pagination-clickable="true" navigation="true" loop="true" style="width: 100% !important;">
                        <swiper-slide class="p-4"><a href="/media/{{ producto.iProductImg }}"
                                data-lightbox="image-1"><img src="/media/{{ producto.iProductImg }}" id="img-producto"
                                    class="img-fluid" alt="Imagen"></a></swiper-slide>
                        <swiper-slide class="p-4"><a href="/media/{{ producto.iInfoImg }}" data-lightbox="image-2"><img
                                    src="/media/{{ producto.iInfoImg }}" class="img-fluid"
                                    alt="Imagen"></a></swiper-slide>
                    </swiper-container>
                </div>
                <div class="col-lg-12 col-xl-7 m-auto pt-4" style="text-align:left; position: relative;">
                    <div class="show-avis-carrito" style="width: 100%;"></div>
                    <div class="d-flex justify-content-between">
                        <h3 class="my-3"> <strong style="text-transform: capitalize;"
                                id="producto">{{producto.nombre_producto}}</strong> </h3>
                        <strong style="float:right; margin: 10px; font-size: 2rem;" class="text-danger"
                            id="precio">{{producto.precio_pub}}</strong>
                    </div>
                    <div class="mb-3 scrollbar-add-descrip"
                        style="max-height: 150px; height: auto; overflow-y: scroll;">
                        {{producto.descripcion}} </div>
                    <hr>
                    <ul class="list-group list-group-flush mt-4">
                        <li class="d-flex align-items-center gap-4">
                            <strong>Sabores:</strong>
                            <select class="form-select" style="text-transform: capitalize;"
                                aria-label="Default select example" required name="sabor">
                                <option value="" selected>- - -</option>
                                {% for sabor in sabores %}
                                <option value="{{sabor}}">{{ sabor }}</option>
                                {% endfor %}
                            </select>
                        </li>
                        <hr>
                        <li class="d-flex align-items-center gap-4">
                            <strong>Cantidad:</strong>
                            <div class="number-input">
                                <button type="button" class="decrement">-</button>
                                <input class="quantity" min="1" name="cantidad" value="1" type="number"
                                    autocomplete="off" step="1" id="cantidad-ingresada" max="100" required readonly
                                    oninput="this.value = this.value.replace(/[^0-9]/g, ''); if (this.value === '0') this.value = ''">
                                <button type="button" class="increment">+</button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <hr>
            <div class="col-md-11  mx-auto pb-1 gap-3 d-flex justify-content-center">
                <button type="submit" class="btn CartBtn bg-danger" style="width: 200px; height: auto;">
                    <span class="IconContainer">
                        <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512" fill="#fff"
                            class="cart">
                            <path
                                d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z">
                            </path>
                        </svg>
                    </span>
                    <p class="text">Añadir al pedido</p>
                </button>
            </div>
        </form>
    </div>
</section>
{% block mobile-home %}
{% endblock %}
{% block mobile-title %}
{% endblock %}

<section class="mobile añadir mt-4">
    <div class="d-flex justify-content-end">
        <a class="nav-link item-order-mobile d-flex align-items-center justify-content-center gap-2"
            href="{% url 'pageOrder' %}" style="background-color: #c00808; color: #fff; border-radius: 5px 0 0 5px;">
            <div class="order-cont-cant">
                <i class="fa fa-shopping-cart" aria-hidden="true" style="color: #fff;"></i>
                <span class="order-cant-mobile"></span>
            </div>
        </a>
    </div>
    <form class="px-4 form product-form-mobile" data-id="{{ producto.id_producto }}">
        <div class="col-md-12">
            <swiper-container class="mySwiper my-auto" keyboard="true" space-between="30" pagination="true"
                pagination-clickable="true" navigation="true" loop="true" style="width: 100% !important;">
                <swiper-slide class="p-4"><a href="/media/{{ producto.iProductImg }}" data-lightbox="image-1"><img
                            src="/media/{{ producto.iProductImg }}" id="img-producto-mobile" class="img-fluid"
                            alt="Imagen"></a></swiper-slide>
                <swiper-slide class="p-4"><a href="/media/{{ producto.iInfoImg }}" data-lightbox="image-2"><img
                            src="/media/{{ producto.iInfoImg }}" class="img-fluid" alt="Imagen"></a></swiper-slide>
            </swiper-container>
        </div>
        <div class=" m-auto" style="text-align:left;">
            <div class="d-flex justify-content-between">
                <h3 class="my-3"> <strong style="text-transform: capitalize;"
                        id="producto-mobile">{{producto.nombre_producto}}</strong> </h3>
                <strong style="float:right; margin: 10px; font-size: 2rem;" class="text-danger"
                    id="precio-mobile">{{producto.precio_pub}}</strong>
            </div>
            <div class="mb-3 scrollbar-add-descrip" style="max-height: 150px; height: auto; overflow-y: scroll;">
                {{producto.descripcion}} </div>
            <hr>
            <ul class="list-group list-group-flush mt-4">
                <li class="d-flex align-items-center gap-4">
                    <strong>Sabores:</strong>
                    <select class="form-select" style="text-transform: capitalize;" aria-label="Default select example"
                        required name="sabor-mobile">
                        <option value="" selected>- - -</option>
                        {% for sabor in sabores %}
                        <option value="{{sabor}}">{{ sabor }}</option>
                        {% endfor %}
                    </select>
                </li>
                <hr>
                <li class="d-flex align-items-center gap-4">
                    <strong>Cantidad:</strong>
                    <div class="number-input">
                        <button type="button" class="decrement">-</button>
                        <input class="quantity" min="1" name="cantidad" value="1" type="number" autocomplete="off"
                            step="1" id="cantidad-ingresada" max="100" required readonly
                            oninput="this.value = this.value.replace(/[^0-9]/g, ''); if (this.value === '0') this.value = ''">
                        <button type="button" class="increment">+</button>
                    </div>
                </li>
            </ul>
        </div>
        <hr>
        <div class="show-avis-carrito" style="width: 100%; z-index: 999;"></div>
        <div class="col-md-11  mx-auto pb-1 gap-3 d-flex justify-content-center">
            <button type="submit" class="btn CartBtn bg-danger" style="width: 200px;">
                <span class="IconContainer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512" fill="#fff" class="cart">
                        <path
                            d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z">
                        </path>
                    </svg>
                </span>
                <p class="text">Añadir al pedido</p>
            </button>
        </div>
    </form>
</section>

<script>

    $(document).ready(function () {

        cargarProductos()
        function cargarProductos() {
            $("#title-search").text("MEJORES VENTAS")
            $.ajax({
                url: "{% url 'mas_vendidos' %}",
                type: "GET",
                success: function (data) {
                    if (data.success) {
                        $("#toggle-main-search-desk").empty();
                        $.each(data.data, function (index, p) {
                            var productList =
                                '<li class="d-flex search-card-desk productDetailsButton" data-id="' + p.id_producto + '">' +
                                '<div style="width:50px; height:50px; overflow: hidden;"><img src="/media/' + p.presentacion + '" alt="Imagen" style="width: 100%; height: 100%; object-fit: cover; object-position: center;" class="img-fluid"></div>' +
                                '<div class="px-2 d-flex gap-2 flex-column">' +
                                '<span style="width: 100px; height:20px; overflow:hidden; text-overflow: ellipsis; white-space: nowrap;">' + p.nombre_producto + '</span>' +
                                '<h6><strong class="text-danger">' + p.precio_pub + '</strong></h6></div></li>';

                            $("#toggle-main-search-desk").append(productList);
                        });
                        $('.productDetailsButton').click(function (event) {
                            if (!$(event.target).closest('.CartBtn').length) {
                                var id_producto = $(this).data("id");
                                $("#search-input").val("");
                                cargarDetalle(id_producto);
                            }
                        });
                    }
                },
            });
        }
        $(document).on("input", "#search-input-desk", function () {
            let search = $(this).val();
            $("#title-search").text("RESULTADOS...");

            if (search.length >= 2) {
                $.ajax({
                    url: "{% url 'search_products' %}",
                    method: 'GET',
                    data: { search: search },
                    success: function (data) {
                        if (data.success) {
                            if (data.data.length > 0) {
                                $("#toggle-main-search-desk").empty().addClass("is-active");

                                $.each(data.data, function (index, p) {
                                    var productList =
                                        '<li class="d-flex search-card-desk productDetailsButton" data-id="' + p.id_producto + '">' +
                                        '<div style="width:50px; height:50px; overflow: hidden;"><img src="/media/' + p.iProductImg_name + '" alt="Imagen" style="width: 100%; height: 100%; object-fit: cover; object-position: center;" class="img-fluid"></div>' +
                                        '<div class="px-2 d-flex gap-2 flex-column">' +
                                        '<span  style="width: 100px; height:20px; overflow:hidden; text-overflow: ellipsis; white-space: nowrap;">' + p.nombre_producto + '</span>' +
                                        '<h6><strong class=" text-danger">' + p.precio_pub + '</strong></h6></div></li>';

                                    $("#toggle-main-search-desk").append(productList);
                                });

                                $("#toggle-main-search-desk").on("click", '.productDetailsButton', function () {
                                    var id_producto = $(this).data("id");
                                    $("#search-input-desk").val("");
                                    cargarDetalle(id_producto);
                                    cargarProductos()
                                });
                            } else {
                                $("#toggle-main-search-desk").empty().removeClass("is-active");
                                $("#title-search").text("NO SE HAN ENCONTRADO RESULTADOS");
                            }
                        }
                    }
                });
            } else {
                $("#toggle-main-search-desk").empty().removeClass("is-active");
                cargarProductos();
            }
        });

        $("#search-clear-desk").on("click", function () {
            $("#search-input-desk").val("");
            $("#toggle-main-search-desk").empty().removeClass("is-active");
            cargarProductos();
        });
    });
</script>
{% endblock %}